# ç³»ç»Ÿä¾èµ–å®‰è£…
âš ï¸åŠ¡å¿…æŒ‰ç…§æ•™ç¨‹å®‰è£…é¡ºåºè¿›è¡Œè½¯ä»¶ã€å·¥å…·çš„å®‰è£…

âš ï¸æ¨èä½¿ç”¨condaç¯å¢ƒè¿›è¡Œå®‰è£…ï¼ŒPyQt5ã€OpenCVå¯ä»¥ç›´æ¥ä½¿ç”¨condaé¢„ç¼–è¯‘å¥½çš„ç‰ˆæœ¬ã€‚pipåœ¨arm64 4GBåŠå…¶ä»¥ä¸‹è®¾å¤‡ä¸ŠPyQt5ã€OpenCVæå…¶å®¹æ˜“ç¼–è¯‘å¤±è´¥æ— æ³•å®‰è£…


## ç³»ç»Ÿä¾èµ–å®‰è£…
### å¤šåª’ä½“å¤„ç†ç»„ä»¶
#### 1. **FFmpeg è§†é¢‘å¤„ç†å·¥å…·**

##### ğŸ“¦ Windows å®‰è£…æ–¹å¼

* **æ¨èæ–¹å¼ï¼šä½¿ç”¨ Scoop å®‰è£…**

  ```bash
  scoop install ffmpeg
  ```

* **æ‰‹åŠ¨å®‰è£…**

  1. å‰å¾€ [BtbN/FFmpeg-Builds](https://github.com/BtbN/FFmpeg-Builds/releases) ä¸‹è½½å¯¹åº”ç‰ˆæœ¬
  2. è§£å‹åå°† `bin` ç›®å½•è·¯å¾„æ·»åŠ è‡³ç³»ç»Ÿç¯å¢ƒå˜é‡ `PATH`

##### ğŸŒ è·¨å¹³å°å®‰è£…ï¼ˆé€‚ç”¨äº Conda ç¯å¢ƒï¼‰

```bash
conda install -c conda-forge ffmpeg
```

---

#### 2. **Opus éŸ³é¢‘ç¼–è§£ç å™¨**

* é»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®å·²è‡ªåŠ¨å¼•å…¥ `opus.dll`ï¼Œ**é€šå¸¸æ— éœ€é¢å¤–å®‰è£…**

* å¦‚é‡æ‰¾ä¸åˆ°åº“çš„é—®é¢˜ï¼ŒWindows ç”¨æˆ·å¯æ‰‹åŠ¨å¤åˆ¶ `/libs/windows/opus.dll` åˆ°ä»¥ä¸‹ä»»ä¸€ä½ç½®ï¼š

  * åº”ç”¨ç¨‹åºè¿è¡Œç›®å½•
  * `C:\Windows\System32`

##### Conda ç¯å¢ƒå®‰è£…æ–¹å¼ï¼š

```bash
conda install -c conda-forge opus
```

### Linux (Debian/Ubuntu)
```bash
# å®‰è£…ç³»ç»Ÿä¾èµ–
sudo apt-get update
# å¿…è£…
sudo apt-get install python3-pyaudio portaudio19-dev ffmpeg libopus0 libopus-dev build-essential  python3-venv

# å®‰è£…éŸ³é‡æ§åˆ¶ä¾èµ–ï¼ˆä»¥ä¸‹ä¸‰é€‰ä¸€ï¼‰
# 1. PulseAudio å·¥å…·ï¼ˆæ¨èï¼‰
sudo apt-get install pulseaudio-utils

# 2. æˆ–è€… ALSA å·¥å…·
sudo apt-get install alsa-utils

# 3. å¦‚æœéœ€è¦ä½¿ç”¨ alsamixer æ–¹å¼ï¼Œè¿˜éœ€è¦å®‰è£… expect
sudo apt-get install alsa-utils expect
```

### macOS
```bash
# ä½¿ç”¨ Homebrew å®‰è£…ç³»ç»Ÿä¾èµ–
brew install portaudio opus python-tk ffmpeg gfortran
brew upgrade tcl-tk
```

## Python ä¾èµ–å®‰è£…

---

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Minicondaï¼ˆæ¨èï¼‰

### 1. ä¸‹è½½ Miniconda å®‰è£…åŒ…ï¼ˆ
æ ¹æ®ä½ çš„ç³»ç»Ÿæ¶æ„æˆ–æ“ä½œç³»ç»Ÿé€‰æ‹©ä¸‹è½½å‘½ä»¤ï¼š

| ç³»ç»Ÿ / æ¶æ„ | ä¸‹è½½æŒ‡ä»¤ |
|:-----------|:---------|
| **Linux - x86_64**ï¼ˆPC/æœåŠ¡å™¨å¸¸ç”¨ï¼‰ | ```bash wget -O Miniconda3-latest-Linux-x86_64.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh ``` |
| **Linux - aarch64**ï¼ˆARM64ï¼Œæ¯”å¦‚æ ‘è“æ´¾ã€éƒ¨åˆ†æœåŠ¡å™¨ï¼‰ | ```bash wget -O Miniconda3-latest-Linux-aarch64.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-aarch64.sh ``` |
| **Linux - ppc64le**ï¼ˆIBM PoweræœåŠ¡å™¨ï¼‰ | ```bash wget -O Miniconda3-latest-Linux-ppc64le.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-ppc64le.sh ``` |
| **Windows - x86_64**ï¼ˆæ™®é€šWindows PCï¼‰ | [ç‚¹å‡»ä¸‹è½½](https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-x86_64.exe) |
| **Windows - arm64**ï¼ˆARM Windowsè®¾å¤‡ï¼Œå¦‚Surface Pro Xï¼‰ | [ç‚¹å‡»ä¸‹è½½](https://repo.anaconda.com/miniconda/Miniconda3-latest-Windows-arm64.exe) |
| **macOS - x86_64**ï¼ˆIntelèŠ¯ç‰‡Macï¼‰ | ```bash wget -O Miniconda3-latest-MacOSX-x86_64.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh ``` |
| **macOS - arm64**ï¼ˆApple SiliconèŠ¯ç‰‡ï¼Œå¦‚M1/M2/M3ï¼‰ | ```bash wget -O Miniconda3-latest-MacOSX-arm64.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-arm64.sh ``` |

---

### 2. ç»™å®‰è£…è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆä»…Linux/macOSï¼‰

```bash
chmod +x Miniconda3-latest-*.sh
```

### 3. è¿è¡Œå®‰è£…ç¨‹åºï¼ˆä»…Linux/macOSï¼‰

```bash
./Miniconda3-latest-*.sh
```
âš¡ *æ³¨æ„ï¼šLinux/macOSä¸‹ä¸éœ€è¦ç”¨`sudo`ï¼Œç”¨æ™®é€šç”¨æˆ·å®‰è£…å³å¯ã€‚*

---

### 4. å®‰è£…è¿‡ç¨‹ä¸­ ï¼ˆwindowsè¯·æŒ‰ç…§ç½‘ç»œæœç´¢åˆ°çš„æ•™ç¨‹æ¥ï¼‰

1. å‡ºç°è®¸å¯åè®® â†’ æŒ‰ `Enter` é”®æ…¢æ…¢ç¿»ï¼Œæˆ–æŒ‰ `q` ç›´æ¥è·³è¿‡ã€‚
2. è¾“å…¥ `yes` æ¥å—åè®®ã€‚
3. é€‰æ‹©å®‰è£…è·¯å¾„ï¼Œé»˜è®¤æ˜¯ `$HOME/miniconda3` â†’ ç›´æ¥æŒ‰ `Enter` ç¡®è®¤ã€‚
4. æ˜¯å¦åˆå§‹åŒ– Miniconda â†’ è¾“å…¥ `yes`ï¼ˆæ¨èï¼‰ã€‚

---

### 5. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœæœªè‡ªåŠ¨é…ç½®ï¼‰

Linux/macOS ç¼–è¾‘ `.bashrc`ï¼š

```bash
nano ~/.bashrc
```

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š

```bash
export PATH="$HOME/miniconda3/bin:$PATH"
```

ä¿å­˜å¹¶é€€å‡ºï¼š
- æŒ‰ `Ctrl + X`
- æŒ‰ `Y`
- æŒ‰ `Enter`

è®©é…ç½®ç«‹å³ç”Ÿæ•ˆï¼š

```bash
source ~/.bashrc
```

---

### 6. æ£€æŸ¥ conda å®‰è£…æˆåŠŸ

```bash
conda --version
```
å¦‚æœçœ‹åˆ°ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚ `conda 24.1.2`ï¼Œå°±ä»£è¡¨å®‰è£…æˆåŠŸï¼

---

### 7. åˆå§‹åŒ–condaï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
conda init
bash
```

ç„¶åæ‰“å¼€æ–°ç»ˆç«¯ï¼Œçœ‹åˆ° `(base)`ï¼Œè¯´æ˜ç¯å¢ƒæ­£å¸¸æ¿€æ´»ã€‚

---

### 8. ï¼ˆæ¨èï¼‰å…³é—­å¼€æœºè‡ªåŠ¨æ¿€æ´» base ç¯å¢ƒ

```bash
conda config --set auto_activate_base false
```

è¿™æ ·ä»¥åæ‰“å¼€ç»ˆç«¯æ˜¯å¹²å‡€çš„ï¼Œéœ€è¦çš„æ—¶å€™å†æ‰‹åŠ¨ `conda activate base`ã€‚

### ä¸€é”®è‡ªåŠ¨æ›´æ¢å½“å‰ç½‘ç»œä¸‹æœ€å¿«pipè½¯ä»¶æº

* **ä¸ºäº†æ›´ç¨³å®šæ›´å¿«é€Ÿçš„å®‰è£…æ‰€éœ€ä¾èµ–åŒ…ï¼Œå»ºè®®å®‰è£…**

[å·¥å…·åœ°å€|chsrc å…¨å¹³å°é€šç”¨æ¢æºå·¥å…·|GitHubä»“åº“](https://github.com/RubyMetric/chsrc)

```bash
# windowså®‰è£…ï¼ˆPowerShellç®¡ç†å‘˜æƒé™æ‰“å¼€è¾“å…¥ä¸‹é¢è¿™å¥ï¼‰
winget install RubyMetric.chsrc --source winget

# ä¸ªäººæœåŠ¡å™¨ï¼ŒåŠ é€Ÿä¸‹è½½ï¼Œæ”¯æŒx86_64å’Œarm64æ¶æ„
wget -O- aslant.top/chsrc.sh|sudo bash

# æ›´æ¢pipè½¯ä»¶æº
chsrc set pip
```

## å®‰è£…é¡¹ç›®ä¾èµ–

### 1. åˆ›å»º Conda ç¯å¢ƒ
```bash
conda create -n py-xiaozhi python=3.10 -y
```

### 2. æ¿€æ´»ç¯å¢ƒ
```bash
conda activate py-xiaozhi
```

### 3. å®‰è£… Python ä¾èµ–
```bash
# Windows/Linux
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple
# macOS
pip install -r requirements_mac.txt -i https://mirrors.aliyun.com/pypi/simple
```

* å®‰è£…å…¶å®ƒä¾èµ–(**å› ä¸ºpipå®‰è£…è¿™ä¸¤ä¸ªå¯èƒ½ä¼šå¯åŠ¨ä¸äº†ã€‚éœ€è¦åœ¨condaå•ç‹¬å®‰è£…**)
```bash
# ä¾ç„¶åœ¨åˆ›å»ºçš„px-xiaozhiè™šæ‹Ÿç¯å¢ƒä¸­
# PyQt5
conda install pyqt=5.15.10 -y

# OpenCV
conda install opencv=4.10.0 -y

# windowsç”µè„‘éœ€è¦å•ç‹¬å®‰è£…è¿™ä¸ª
pip install wmi
```


---

### æ–¹å¼äºŒï¼šä½¿ç”¨ venv (ä¸å†æ¨è)
- macä¸Šä¼šæç¤ºç³»ç»Ÿæ— æ³•éªŒè¯ SSL è¯ä¹¦çš„ç­¾å‘æœºæ„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¼ºå°‘æˆ–æœªå®‰è£…ç³»ç»Ÿæ ¹è¯ä¹¦ï¼ˆCA certificatesï¼‰
```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
.venv\Scripts\activate
# Linux/macOS
source .venv/bin/activate

# 3. å®‰è£…ä¾èµ–
# Windows/Linux
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple
# macOS
pip install -r requirements_mac.txt -i https://mirrors.aliyun.com/pypi/simple

# ç”±äºrequirements å»é™¤äº†è¿™å‡ ä¸ªé»˜è®¤çš„éœ€è¦å•ç‹¬å®‰è£…
pip install PyQt5==5.15.9 opencv-python==4.11.0.86 wmi==1.5.1 -i https://mirrors.aliyun.com/pypi/simple
```

## æ³¨æ„äº‹é¡¹
1. å»ºè®®ä½¿ç”¨ Python 3.9.13+ ç‰ˆæœ¬ï¼Œæ¨è 3.10 æœ€å¤§ç‰ˆæœ¬3.12ï¼ˆä¸è¡Œå°±é™çº§ï¼‰
2. Windows ç”¨æˆ·æ— éœ€æ‰‹åŠ¨å®‰è£… opus.dllï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨å¤„ç†
3. ä½¿ç”¨ Conda ç¯å¢ƒæ—¶å¿…é¡»å®‰è£… ffmpeg å’Œ Opus
4. ä½¿ç”¨ Conda ç¯å¢ƒæ—¶è¯·å‹¿å’Œesp32-serverå…±ç”¨åŒä¸€ä¸ªCondaç¯å¢ƒï¼Œå› ä¸ºæœåŠ¡ç«¯websocketä¾èµ–ç‰ˆæœ¬é«˜äºæœ¬é¡¹ç›®
5. å»ºè®®ä½¿ç”¨å›½å†…é•œåƒæºå®‰è£…ä¾èµ–ï¼Œå¯ä»¥æé«˜ä¸‹è½½é€Ÿåº¦
6. macOS ç”¨æˆ·éœ€ä½¿ç”¨ä¸“é—¨çš„ requirements_mac.txt
7. ç¡®ä¿ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆåå†å®‰è£… Python ä¾èµ–