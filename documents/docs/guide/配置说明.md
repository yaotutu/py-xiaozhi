# ğŸ“‹ é…ç½®è¯´æ˜

## ğŸ”§ é…ç½®ç³»ç»Ÿæ¦‚è§ˆ

### é…ç½®æ–‡ä»¶ç»“æ„
py-xiaozhi é‡‡ç”¨åˆ†å±‚é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§é…ç½®ç®¡ç†æ–¹å¼ï¼š

```
ğŸ“ config/
â”œâ”€â”€ ğŸ“„ config.json          # ä¸»é…ç½®æ–‡ä»¶ï¼ˆè¿è¡Œæ—¶é…ç½®ï¼‰
â””â”€â”€ ğŸ“„ efuse.json           # è®¾å¤‡èº«ä»½æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

### é…ç½®å±‚æ¬¡ç»“æ„

1. **é»˜è®¤é…ç½®æ¨¡æ¿**
   - ä½ç½®ï¼š`src/utils/config_manager.py` ä¸­çš„ `DEFAULT_CONFIG`
   - ä½œç”¨ï¼šæä¾›ç³»ç»Ÿé»˜è®¤é…ç½®å€¼
   - ç”¨é€”ï¼šé¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆé…ç½®æ–‡ä»¶çš„æ¨¡æ¿

2. **è¿è¡Œæ—¶é…ç½®æ–‡ä»¶**
   - ä½ç½®ï¼š`config/config.json`
   - ä½œç”¨ï¼šå­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
   - ç”¨é€”ï¼šç³»ç»Ÿè¿è¡Œæ—¶è¯»å–çš„å®é™…é…ç½®

3. **è®¾å¤‡èº«ä»½æ–‡ä»¶**
   - ä½ç½®ï¼š`config/efuse.json`
   - ä½œç”¨ï¼šå­˜å‚¨è®¾å¤‡å”¯ä¸€æ ‡è¯†å’Œæ¿€æ´»çŠ¶æ€
   - ç”¨é€”ï¼šè®¾å¤‡æ¿€æ´»å’Œèº«ä»½éªŒè¯

### é…ç½®è®¿é—®æ–¹å¼

é…ç½®ç³»ç»Ÿæ”¯æŒç‚¹åˆ†éš”è·¯å¾„è®¿é—®ï¼Œä¾¿äºè·å–å’Œä¿®æ”¹åµŒå¥—é…ç½®ï¼š

```python
# è·å–é…ç½®ç¤ºä¾‹
from src.utils.config_manager import ConfigManager
config = ConfigManager.get_instance()

# è·å–ç½‘ç»œé…ç½®
websocket_url = config.get_config("SYSTEM_OPTIONS.NETWORK.WEBSOCKET_URL")

# è·å–å”¤é†’è¯é…ç½®
wake_words = config.get_config("WAKE_WORD_OPTIONS.WAKE_WORDS")

# æ›´æ–°é…ç½®
config.update_config("WAKE_WORD_OPTIONS.USE_WAKE_WORD", True)
config.update_config("CAMERA.VLapi_key", "your_api_key_here")

# é‡æ–°åŠ è½½é…ç½®
config.reload_config()
```

## ğŸŒ ç³»ç»Ÿé…ç½® (SYSTEM_OPTIONS)

### åŸºç¡€ç³»ç»Ÿé…ç½®

```json
{
  "SYSTEM_OPTIONS": {
    "CLIENT_ID": "è‡ªåŠ¨ç”Ÿæˆçš„å®¢æˆ·ç«¯ID",
    "DEVICE_ID": "è®¾å¤‡MACåœ°å€",
    "NETWORK": {
      "OTA_VERSION_URL": "https://api.tenclass.net/xiaozhi/ota/",
      "WEBSOCKET_URL": "ws://your-server:8000/xiaozhi/v1/",
      "WEBSOCKET_ACCESS_TOKEN": "è®¿é—®ä»¤ç‰Œ",
      "MQTT_INFO": {
        "endpoint": "mqtt.server.com",
        "client_id": "xiaozhi_client",
        "username": "your_username",
        "password": "your_password",
        "publish_topic": "xiaozhi/commands",
        "subscribe_topic": "xiaozhi/responses"
      },
      "ACTIVATION_VERSION": "v2",
      "AUTHORIZATION_URL": "https://xiaozhi.me/"
    }
  }
}
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `CLIENT_ID` | String | è‡ªåŠ¨ç”Ÿæˆ | å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| `DEVICE_ID` | String | MACåœ°å€ | è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦ |
| `WEBSOCKET_URL` | String | null | WebSocketæœåŠ¡å™¨åœ°å€ |
| `WEBSOCKET_ACCESS_TOKEN` | String | null | WebSocketè®¿é—®ä»¤ç‰Œ |
| `ACTIVATION_VERSION` | String | "v2" | æ¿€æ´»åè®®ç‰ˆæœ¬ (v1/v2) |
| `AUTHORIZATION_URL` | String | "https://xiaozhi.me/" | è®¾å¤‡æˆæƒåœ°å€ |

## ğŸ¤ å”¤é†’è¯é…ç½® (WAKE_WORD_OPTIONS)

### è¯­éŸ³å”¤é†’è®¾ç½®

```json
{
  "WAKE_WORD_OPTIONS": {
    "USE_WAKE_WORD": false,
    "MODEL_PATH": "models/vosk-model-small-cn-0.22",
    "WAKE_WORDS": ["å°æ™º", "å°ç¾"],
    "SIMILARITY_THRESHOLD": 0.8
  }
}
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `USE_WAKE_WORD` | Boolean | false | æ˜¯å¦å¯ç”¨è¯­éŸ³å”¤é†’ |
| `MODEL_PATH` | String | "models/vosk-model-small-cn-0.22" | Voskæ¨¡å‹è·¯å¾„ |
| `WAKE_WORDS` | Array | ["å°æ™º", "å°ç¾"] | å”¤é†’è¯åˆ—è¡¨ |
| `SIMILARITY_THRESHOLD` | Float | 0.8 | ç›¸ä¼¼åº¦é˜ˆå€¼ |

### å”¤é†’è¯æ¨¡å‹ä¸‹è½½

```bash
# ä¸‹è½½ä¸­æ–‡å°å‹æ¨¡å‹ï¼ˆæ¨èï¼‰
wget -O models/vosk-model-small-cn-0.22.zip \
  https://alphacephei.com/vosk/models/vosk-model-small-cn-0.22.zip

# è§£å‹åˆ°modelsç›®å½•
cd models && unzip vosk-model-small-cn-0.22.zip
```

## ğŸ“· æ‘„åƒå¤´é…ç½® (CAMERA)

### è§†è§‰è¯†åˆ«è®¾ç½®

```json
{
  "CAMERA": {
    "camera_index": 0,
    "frame_width": 640,
    "frame_height": 480,
    "fps": 30,
    "Local_VL_url": "https://open.bigmodel.cn/api/paas/v4/",
    "VLapi_key": "your_zhipu_api_key",
    "models": "glm-4v-plus"
  }
}
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `camera_index` | Integer | 0 | æ‘„åƒå¤´è®¾å¤‡ç´¢å¼• |
| `frame_width` | Integer | 640 | ç”»é¢å®½åº¦ |
| `frame_height` | Integer | 480 | ç”»é¢é«˜åº¦ |
| `fps` | Integer | 30 | å¸§ç‡ |
| `Local_VL_url` | String | æ™ºè°±APIåœ°å€ | è§†è§‰æ¨¡å‹APIåœ°å€ |
| `VLapi_key` | String | "" | æ™ºè°±APIå¯†é’¥ |
| `models` | String | "glm-4v-plus" | è§†è§‰æ¨¡å‹åç§° |

### æ‘„åƒå¤´æµ‹è¯•

```bash
# æµ‹è¯•æ‘„åƒå¤´åŠŸèƒ½
python scripts/camera_scanner.py

# åœ¨ç¨‹åºä¸­æµ‹è¯•è§†è§‰è¯†åˆ«
è¯­éŸ³è¯¢é—®ï¼Œçœ‹çœ‹æ‘„åƒå¤´å‰æœ‰ä»€ä¹ˆï¼Ÿ
```

## âŒ¨ï¸ å¿«æ·é”®é…ç½® (SHORTCUTS)

### å…¨å±€å¿«æ·é”®è®¾ç½®

```json
{
  "SHORTCUTS": {
    "ENABLED": true,
    "MANUAL_PRESS": {
      "modifier": "ctrl",
      "key": "j",
      "description": "æŒ‰ä½è¯´è¯"
    },
    "AUTO_TOGGLE": {
      "modifier": "ctrl",
      "key": "k",
      "description": "è‡ªåŠ¨å¯¹è¯"
    },
    "ABORT": {
      "modifier": "ctrl",
      "key": "q",
      "description": "ä¸­æ–­å¯¹è¯"
    },
    "MODE_TOGGLE": {
      "modifier": "ctrl",
      "key": "m",
      "description": "åˆ‡æ¢æ¨¡å¼"
    },
    "WINDOW_TOGGLE": {
      "modifier": "ctrl",
      "key": "w",
      "description": "æ˜¾ç¤º/éšè—çª—å£"
    }
  }
}
```

### å¿«æ·é”®è¯´æ˜

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `Ctrl+J` | æŒ‰ä½è¯´è¯ | æŒ‰ä½æœŸé—´å½•éŸ³ï¼Œé‡Šæ”¾åå‘é€ |
| `Ctrl+K` | è‡ªåŠ¨å¯¹è¯ | å¼€å¯/å…³é—­è‡ªåŠ¨å¯¹è¯æ¨¡å¼ |
| `Ctrl+Q` | ä¸­æ–­å¯¹è¯ | ä¸­æ–­å½“å‰å¯¹è¯ |
| `Ctrl+M` | åˆ‡æ¢æ¨¡å¼ | åœ¨ä¸åŒå¯¹è¯æ¨¡å¼é—´åˆ‡æ¢ |
| `Ctrl+W` | æ˜¾ç¤º/éšè—çª—å£ | æ˜¾ç¤ºæˆ–éšè—ä¸»çª—å£ |

## ğŸ”Œ åè®®é…ç½®è¯¦è§£

### WebSocket åè®®é…ç½®
- å¦‚æœéœ€è¦ä½¿ç”¨è‡ªè¡Œéƒ¨ç½²çš„æœåŠ¡ç«¯ï¼Œåªéœ€è¦æ”¹otaæ¥å£ä¸ºè‡ªå·±çš„å°±è¡Œäº†ï¼Œotaä¼šä¸‹å‘wssé“¾æ¥å’Œtoken
```json
{
  "SYSTEM_OPTIONS": {
    "NETWORK": {
      "WEBSOCKET_URL": "ws://192.168.1.100:8000/xiaozhi/v1/",
      "WEBSOCKET_ACCESS_TOKEN": "your_access_token"
    }
  }
}
```

**é…ç½®è¦ç‚¹ï¼š**
- URLå¿…é¡»ä»¥ `ws://` æˆ– `wss://` å¼€å¤´
- æ”¯æŒIPåœ°å€æˆ–åŸŸå
- é»˜è®¤ç«¯å£ä¸º8000ï¼Œå¯æ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´
- è®¿é—®ä»¤ç‰Œç”¨äºèº«ä»½éªŒè¯

### MQTT åè®®é…ç½®

```json
{
  "SYSTEM_OPTIONS": {
    "NETWORK": {
      "MQTT_INFO": {
        "endpoint": "mqtt.server.com",
        "port": 1883,
        "client_id": "xiaozhi_client_001",
        "username": "your_username",
        "password": "your_password",
        "publish_topic": "xiaozhi/commands",
        "subscribe_topic": "xiaozhi/responses",
        "qos": 1,
        "keep_alive": 60
      }
    }
  }
}
```

**é…ç½®è¦ç‚¹ï¼š**
- `endpoint`: MQTTæœåŠ¡å™¨åœ°å€
- `port`: é€šå¸¸ä¸º1883ï¼ˆéåŠ å¯†ï¼‰æˆ–8883ï¼ˆTLSåŠ å¯†ï¼‰
- `client_id`: å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†
- `qos`: æ¶ˆæ¯è´¨é‡ç­‰çº§ï¼ˆ0-2ï¼‰
- `keep_alive`: å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰

## ğŸ” è®¾å¤‡æ¿€æ´»é…ç½®

### æ¿€æ´»ç‰ˆæœ¬è¯´æ˜

```json
{
  "SYSTEM_OPTIONS": {
    "NETWORK": {
      "ACTIVATION_VERSION": "v2",
      "AUTHORIZATION_URL": "https://xiaozhi.me/"
    }
  }
}
```

**ç‰ˆæœ¬å·®å¼‚ï¼š**
- **v1**: ç®€åŒ–æ¿€æ´»æµç¨‹ï¼Œæ— éœ€éªŒè¯ç 
- **v2**: å®Œæ•´æ¿€æ´»æµç¨‹ï¼ŒåŒ…å«éªŒè¯ç éªŒè¯

### è®¾å¤‡èº«ä»½æ–‡ä»¶ (efuse.json)

```json
{
  "serial_number": "SN-E3E1F618-902e16dbe116",
  "hmac_key": "b5bf012dd518080532f928b70ed958799f34f9224e80dd4128795a70a5baca24",
  "activation_status": false,
  "mac_address": "00:11:22:33:44:55",
  "device_fingerprint": {
    "cpu_info": "...",
    "memory_info": "...",
    "disk_info": "..."
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `serial_number`: è®¾å¤‡åºåˆ—å·
- `hmac_key`: è®¾å¤‡éªŒè¯å¯†é’¥
- `activation_status`: æ¿€æ´»çŠ¶æ€
- `mac_address`: è®¾å¤‡MACåœ°å€
- `device_fingerprint`: è®¾å¤‡æŒ‡çº¹ä¿¡æ¯

## ğŸ› ï¸ é…ç½®ç®¡ç†å®ç”¨æŠ€å·§

### 1. é…ç½®æ–‡ä»¶ç”Ÿæˆ

```bash
# é¦–æ¬¡è¿è¡Œè‡ªåŠ¨ç”Ÿæˆé…ç½®
python main.py

# é‡æ–°ç”Ÿæˆé»˜è®¤é…ç½®
rm config/config.json
python main.py
```


## ğŸš¨ å¸¸è§é…ç½®é—®é¢˜

### 1. WebSocketè¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**:
```json
{
  "SYSTEM_OPTIONS": {
    "NETWORK": {
      "WEBSOCKET_URL": "ws://æ­£ç¡®çš„æœåŠ¡å™¨åœ°å€:ç«¯å£/xiaozhi/v1/",
      "WEBSOCKET_ACCESS_TOKEN": "test-token"
    }
  }
}
```

### 2. å”¤é†’è¯ä¸å·¥ä½œ

**ç—‡çŠ¶**: è¯­éŸ³å”¤é†’æ— å“åº”

**è§£å†³æ–¹æ¡ˆ**:
```json
{
  "WAKE_WORD_OPTIONS": {
    "USE_WAKE_WORD": true,
    "MODEL_PATH": "models/vosk-model-small-cn-0.22",
    "WAKE_WORDS": ["å°æ™º", "å°ç¾"]
  }
}
```

**æ£€æŸ¥æ­¥éª¤**:
1. ç¡®ä¿æ¨¡å‹æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥éŸ³é¢‘è®¾å¤‡æƒé™
3. æµ‹è¯•éº¦å…‹é£åŠŸèƒ½

### 3. æ‘„åƒå¤´æ— æ³•ä½¿ç”¨

**ç—‡çŠ¶**: æ‹ç…§åŠŸèƒ½å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**:
```json
{
  "CAMERA": {
    "camera_index": 0,
    "VLapi_key": "æœ‰æ•ˆçš„æ™ºè°±APIå¯†é’¥"
  }
}
```

**æ£€æŸ¥æ­¥éª¤**:
1. è¿è¡Œæ‘„åƒå¤´æµ‹è¯•è„šæœ¬
2. æ£€æŸ¥APIå¯†é’¥æœ‰æ•ˆæ€§
3. éªŒè¯ç½‘ç»œè¿æ¥

### 4. è®¾å¤‡æ¿€æ´»å¤±è´¥

**ç—‡çŠ¶**: æ¿€æ´»è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤æ¿€æ´»ç‰ˆæœ¬è®¾ç½®
3. æ¸…ç†è®¾å¤‡èº«ä»½æ–‡ä»¶ï¼š
   ```bash
   rm config/efuse.json
   python main.py  # é‡æ–°æ¿€æ´»
   ```

## ğŸ“š é…ç½®æ–‡ä»¶æ¨¡æ¿

### å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "SYSTEM_OPTIONS": {
    "CLIENT_ID": "12345678-1234-1234-1234-123456789012",
    "DEVICE_ID": "00:11:22:33:44:55",
    "NETWORK": {
      "OTA_VERSION_URL": "https://api.tenclass.net/xiaozhi/ota/",
      "WEBSOCKET_URL": "ws://192.168.1.100:8000/xiaozhi/v1/",
      "WEBSOCKET_ACCESS_TOKEN": "your_access_token",
      "MQTT_INFO": {
        "endpoint": "mqtt.server.com",
        "client_id": "xiaozhi_client",
        "username": "your_username",
        "password": "your_password",
        "publish_topic": "xiaozhi/commands",
        "subscribe_topic": "xiaozhi/responses"
      },
      "ACTIVATION_VERSION": "v2",
      "AUTHORIZATION_URL": "https://xiaozhi.me/"
    }
  },
  "WAKE_WORD_OPTIONS": {
    "USE_WAKE_WORD": true,
    "MODEL_PATH": "models/vosk-model-small-cn-0.22",
    "WAKE_WORDS": ["å°æ™º", "å°ç¾", "ä½ å¥½å°æ™º"]
  },
  "CAMERA": {
    "camera_index": 0,
    "frame_width": 640,
    "frame_height": 480,
    "fps": 30,
    "Local_VL_url": "https://open.bigmodel.cn/api/paas/v4/",
    "VLapi_key": "your_zhipu_api_key",
    "models": "glm-4v-plus"
  },
  "SHORTCUTS": {
    "ENABLED": true,
    "MANUAL_PRESS": {
      "modifier": "ctrl",
      "key": "j",
      "description": "æŒ‰ä½è¯´è¯"
    },
    "AUTO_TOGGLE": {
      "modifier": "ctrl",
      "key": "k",
      "description": "è‡ªåŠ¨å¯¹è¯"
    },
    "ABORT": {
      "modifier": "ctrl",
      "key": "q",
      "description": "ä¸­æ–­å¯¹è¯"
    },
    "MODE_TOGGLE": {
      "modifier": "ctrl",
      "key": "m",
      "description": "åˆ‡æ¢æ¨¡å¼"
    },
    "WINDOW_TOGGLE": {
      "modifier": "ctrl",
      "key": "w",
      "description": "æ˜¾ç¤º/éšè—çª—å£"
    }
  }
}
```